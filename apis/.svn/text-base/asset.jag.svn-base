<%
response.addHeader("Access-Control-Allow-Origin", "*");
response.addHeader("Content-Type", "application/json");

(function () {
    if (!require('/modules/user.js').current()) {
        //response.sendError(401, 'Unauthorized');
        //return;
    }

    var elems,
            store = require('/modules/store.js'),
            paging = store.assetsPaging(request),
            matcher = new URIMatcher(request.getRequestURI()),
            aid = request.getParameter('id');

    var isMyAsset = false;
    if(matcher.match('/{context}/apis/myAsset')){
        isMyAsset = true;
    }

    if (isMyAsset || matcher.match('/{context}/apis/asset/{type}')) {
        var type = matcher.elements().type;
        if (aid) {
            //request format : GET /store/apis/asset/gadget?id=/_sys/gov/gadgets/1.0.0
            var asset = store.asset(type, aid);
            //asset.attributes = asset.attributes();
            print(asset);
        } else {
            var assetsFunc = isMyAsset ? store.userAssets : store.assets ;
            //request formats: GET /store/apis/asset/gadget?start=4
            //                 GET /store/apis/asset/gadget?start=4&count=7
            print(assetsFunc(type, {
                start: Number(request.getParameter('start')) || 0,
                count: Number(request.getParameter('count')) || Number.MAX_VALUE,
                sort: request.getParameter('sort') || 'recent'
            }));
        }
    } else {
        //response.sendError(404, 'API Endpoint Not Found');
    }
})();
%>